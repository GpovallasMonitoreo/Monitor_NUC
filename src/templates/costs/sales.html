{% extends 'base.html' %}
{% block header_title %}Registro de Ventas{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-sm border border-slate-200">
    <div class="flex items-center gap-3 mb-6 border-b border-slate-100 pb-4">
        <div class="p-3 bg-emerald-50 rounded-lg text-emerald-600"><i data-lucide="banknote" class="w-6 h-6"></i></div>
        <div>
            <h2 class="text-xl font-bold text-slate-800">Ventas / Ingresos</h2>
            <p class="text-sm text-slate-500">Registro de saldo a favor.</p>
        </div>
    </div>

    <form class="space-y-6">
        <div class="grid grid-cols-2 gap-6">
            <div>
                <label class="text-xs font-bold text-slate-500 uppercase">Ubicación</label>
                <select id="dev-id" class="w-full p-3 border rounded-lg bg-slate-50"><option>Cargando...</option></select>
            </div>
            <div>
                <label class="text-xs font-bold text-slate-500 uppercase">Concepto</label>
                <input type="text" id="desc" class="w-full p-3 border rounded-lg" placeholder="Ej: Campaña Navidad...">
            </div>
        </div>

        <div class="grid grid-cols-2 gap-6">
            <div>
                <label class="text-xs font-bold text-slate-500 uppercase">Monto Ingreso ($)</label>
                <input type="number" id="amt" class="w-full p-3 border border-emerald-300 rounded-lg font-bold text-emerald-700" placeholder="0.00">
            </div>
            <div>
                <label class="text-xs font-bold text-slate-500 uppercase">Fecha</label>
                <input type="date" id="date" class="w-full p-3 border rounded-lg">
            </div>
        </div>

        <button type="button" onclick="save()" class="w-full bg-emerald-600 text-white py-3 rounded-lg font-bold hover:bg-emerald-700">Registrar Venta</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => { lucide.createIcons(); loadDevs(); document.getElementById('date').valueAsDate = new Date(); });
    async function loadDevs() {
        const r = await fetch('/api/data'); const d = await r.json();
        const s = document.getElementById('dev-id'); s.innerHTML='<option value="">Seleccione...</option>';
        Object.values(d).forEach(x => s.innerHTML+=`<option value="${x.pc_name}">${x.pc_name}</option>`);
    }
    async function save() {
        const dev = document.getElementById('dev-id').value;
        const amt = document.getElementById('amt').value;
        if(!dev || !amt) return alert("Faltan datos");

        await fetch('/costs/add', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({
                device_id: dev, type: 'sale', subtype: 'campaña',
                description: document.getElementById('desc').value,
                amount: amt, date: document.getElementById('date').value
            })
        });
        alert("Guardado"); location.reload();
    }
</script>
{% endblock %}
